jobs:
  Job1:
    name: Windows VM with RDP and Pinggy
    steps:
      - type: script
        name: Setup Windows + RDP + Pinggy
        script: |
          powershell.exe -Command "$p=ConvertTo-SecureString 'Xy!9#2025_RdpStrong*' -AsPlainText -Force; Set-LocalUser -Name 'Administrator' -Password $p; Enable-LocalUser -Name 'Administrator';"
          powershell.exe -Command "Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0; Enable-NetFirewallRule -DisplayGroup 'Remote Desktop';"
          powershell.exe -Command "& 'C:\Program Files\Git\usr\bin\ssh.exe' -p 443 -R0:localhost:3389 -o StrictHostKeyChecking=no -o ServerAliveInterval=30 lVuaQjAzw82+tcp@free.pinggy.io;"
          powershell.exe -Command "for ($i=0; $i -lt 360; $i++) {Start-Sleep -Seconds 60; Write-Host 'Running ' $i ' minutes';}"
    runs-on: Windows-Server-2022-Small
